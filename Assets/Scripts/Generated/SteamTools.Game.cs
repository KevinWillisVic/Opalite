using Heathen.SteamworksIntegration;
using Heathen.SteamworksIntegration.API;
using UnityEngine;
using System.Collections.Generic;
using Steamworks;

namespace SteamTools
{
    public static class Game
    {
        // Generated by SteamToolsSettings

#if APP480
        public const uint AppId = 480;
#elif APP0
        public const uint AppId = 0;
#else
        public const uint AppId = 0;
#endif
        // Default server configuration
        public static SteamGameServerConfiguration ServerConfiguration = new()
        {
            autoInitialize = false,
            autoLogon = false,
            ip = 0,
            gamePort = 0,
            queryPort = 0,
            spectatorPort = 0,
            serverVersion = "",
            usingGameServerAuthApi = false,
            enableHeartbeats = false,
            supportSpectators = false,
            spectatorServerName = "",
            anonymousServerLogin = false,
            gameServerToken = "",
            isPasswordProtected = false,
            serverName = "",
            gameDescription = "",
            gameDirectory = "",
            isDedicated = false,
            maxPlayerCount = 0,
            botPlayerCount = 0,
            mapName = "",
            gameData = "",
            rulePairs = null
        };

        public static void ServerConfigFromIni(string iniData) => ServerConfiguration = SteamGameServerConfiguration.ParseIniString(iniData);
        public static void ServerConfigFromJson(string jsonData) => ServerConfiguration = JsonUtility.FromJson<SteamGameServerConfiguration>(jsonData);

        public static void Initialize()
        {
              Debug.Log($"Initializing for app {AppId}");
             Heathen.SteamworksIntegration.API.App.onSteamInitialized.AddListener(HandleInitialized);
#if UNITY_SERVER
             Heathen.SteamworksIntegration.API.App.Server.Initialize(AppId, ServerConfiguration);
#else
             List<InputActionData> actions = new();

#if APP480
                actions.Add(new("analog_controls", InputActionType.Analog));
                actions.Add(new("backward_thrust", InputActionType.Digital));
                actions.Add(new("fire_lasers", InputActionType.Digital));
                actions.Add(new("forward_thrust", InputActionType.Digital));
                actions.Add(new("menu_cancel", InputActionType.Digital));
                actions.Add(new("menu_down", InputActionType.Digital));
                actions.Add(new("menu_left", InputActionType.Digital));
                actions.Add(new("menu_right", InputActionType.Digital));
                actions.Add(new("menu_select", InputActionType.Digital));
                actions.Add(new("menu_up", InputActionType.Digital));
                actions.Add(new("pause_menu", InputActionType.Digital));
                actions.Add(new("turn_left", InputActionType.Digital));
                actions.Add(new("turn_right", InputActionType.Digital));
#elif APP0
#endif

             Heathen.SteamworksIntegration.API.App.Client.Initialize(AppId, actions.ToArray());
#endif
        }

        private static void HandleInitialized()
        {
            Inputs.Sets.Initialize();
#if APP480
            int boardCount = 1;
            int returnedBoards = 0;
            LeaderboardData.Get("Feet Traveled", (result, ioError) =>
            {
                if(!ioError)
                    Leaderboards.Feet_Traveled = result;

                returnedBoards++;
                if(returnedBoards >= boardCount)
                {
                    Dictionary<string, LeaderboardData> boardMap = Leaderboards.GetMap();
                    Dictionary<string, InputActionSetData> setMap = Inputs.Sets.GetMap();
                    Dictionary<string, InputActionData> actionMap = Inputs.Actions.GetMap();
                    Interface.RaiseOnReady(boardMap, setMap, actionMap);
                }
            });
#elif APP0
                Dictionary<string, LeaderboardData> boardMap = Leaderboards.GetMap();
                Dictionary<string, InputActionSetData> setMap = Inputs.Sets.GetMap();
                Dictionary<string, InputActionData> actionMap = Inputs.Actions.GetMap();
                Interface.RaiseOnReady(boardMap, setMap, actionMap);
#endif
        }
        public static class Stats
        {
#if APP480
            public static StatData AverageSpeed = "AverageSpeed";
            public static StatData FeetTraveled = "FeetTraveled";
            public static StatData MaxFeetTraveled = "MaxFeetTraveled";
            public static StatData NumGames = "NumGames";
            public static StatData NumLosses = "NumLosses";
            public static StatData NumWins = "NumWins";
            public static StatData Unused2 = "Unused2";
#elif APP0
            public static StatData AverageSpeed;
            public static StatData FeetTraveled;
            public static StatData MaxFeetTraveled;
            public static StatData NumGames;
            public static StatData NumLosses;
            public static StatData NumWins;
            public static StatData Unused2;
#else
            public static StatData AverageSpeed;
            public static StatData FeetTraveled;
            public static StatData MaxFeetTraveled;
            public static StatData NumGames;
            public static StatData NumLosses;
            public static StatData NumWins;
            public static StatData Unused2;
#endif
        }

        public static class Achievements
        {
#if APP480
            public static AchievementData ACH_TRAVEL_FAR_ACCUM = "ACH_TRAVEL_FAR_ACCUM";
            public static AchievementData ACH_TRAVEL_FAR_SINGLE = "ACH_TRAVEL_FAR_SINGLE";
            public static AchievementData ACH_WIN_100_GAMES = "ACH_WIN_100_GAMES";
            public static AchievementData ACH_WIN_ONE_GAME = "ACH_WIN_ONE_GAME";
            public static AchievementData NEW_ACHIEVEMENT_0_4 = "NEW_ACHIEVEMENT_0_4";
#elif APP0
            public static AchievementData ACH_TRAVEL_FAR_ACCUM;
            public static AchievementData ACH_TRAVEL_FAR_SINGLE;
            public static AchievementData ACH_WIN_100_GAMES;
            public static AchievementData ACH_WIN_ONE_GAME;
            public static AchievementData NEW_ACHIEVEMENT_0_4;
#else
            public static AchievementData ACH_TRAVEL_FAR_ACCUM;
            public static AchievementData ACH_TRAVEL_FAR_SINGLE;
            public static AchievementData ACH_WIN_100_GAMES;
            public static AchievementData ACH_WIN_ONE_GAME;
            public static AchievementData NEW_ACHIEVEMENT_0_4;
#endif
        }

        public static class Leaderboards
        {
            public static LeaderboardData Feet_Traveled;

            public static Dictionary<string, LeaderboardData> GetMap()
            {
                var map = new Dictionary<string, LeaderboardData>();
                map.Add("Feet Traveled", Feet_Traveled);
                return map;
            }

        }

        public static class Inputs
        {
            public static class Sets
            {

            public static Dictionary<string, InputActionSetData> GetMap()
            {
                var map = new Dictionary<string, InputActionSetData>();
                map.Add("menu_controls", menu_controls);
                map.Add("ship_controls", ship_controls);
                return map;
            }

            public static void Initialize()
            {
#if UNITY_SERVER
                    return;
#endif
#if APP480
                menu_controls = InputActionSetData.Get("menu_controls");
                ship_controls = InputActionSetData.Get("ship_controls");
#elif APP0
#endif
            }
                public static InputActionSetData menu_controls;
                public static InputActionSetData ship_controls;
            }

            public static class Layers
            {
#if APP480
                public static InputActionSetLayerData thrust_action_layer = new(){ layerName = "thrust_action_layer" };
#elif APP0
                public static InputActionSetLayerData thrust_action_layer;
#else
                public static InputActionSetLayerData thrust_action_layer;
#endif
            }

            public static class Actions
            {

#if APP480
                public static InputActionData analog_controls = new InputActionData("analog_controls", InputActionType.Analog);
                public static InputActionData backward_thrust = new InputActionData("backward_thrust", InputActionType.Digital);
                public static InputActionData fire_lasers = new InputActionData("fire_lasers", InputActionType.Digital);
                public static InputActionData forward_thrust = new InputActionData("forward_thrust", InputActionType.Digital);
                public static InputActionData menu_cancel = new InputActionData("menu_cancel", InputActionType.Digital);
                public static InputActionData menu_down = new InputActionData("menu_down", InputActionType.Digital);
                public static InputActionData menu_left = new InputActionData("menu_left", InputActionType.Digital);
                public static InputActionData menu_right = new InputActionData("menu_right", InputActionType.Digital);
                public static InputActionData menu_select = new InputActionData("menu_select", InputActionType.Digital);
                public static InputActionData menu_up = new InputActionData("menu_up", InputActionType.Digital);
                public static InputActionData pause_menu = new InputActionData("pause_menu", InputActionType.Digital);
                public static InputActionData turn_left = new InputActionData("turn_left", InputActionType.Digital);
                public static InputActionData turn_right = new InputActionData("turn_right", InputActionType.Digital);
#elif APP0
                public static InputActionData analog_controls;
                public static InputActionData backward_thrust;
                public static InputActionData fire_lasers;
                public static InputActionData forward_thrust;
                public static InputActionData menu_cancel;
                public static InputActionData menu_down;
                public static InputActionData menu_left;
                public static InputActionData menu_right;
                public static InputActionData menu_select;
                public static InputActionData menu_up;
                public static InputActionData pause_menu;
                public static InputActionData turn_left;
                public static InputActionData turn_right;
#else
                public static InputActionData analog_controls;
                public static InputActionData backward_thrust;
                public static InputActionData fire_lasers;
                public static InputActionData forward_thrust;
                public static InputActionData menu_cancel;
                public static InputActionData menu_down;
                public static InputActionData menu_left;
                public static InputActionData menu_right;
                public static InputActionData menu_select;
                public static InputActionData menu_up;
                public static InputActionData pause_menu;
                public static InputActionData turn_left;
                public static InputActionData turn_right;
#endif

                public static Dictionary<string, InputActionData> GetMap()
                {
                    var map = new Dictionary<string, InputActionData>();
                    map.Add("analog_controls", analog_controls);
                    map.Add("backward_thrust", backward_thrust);
                    map.Add("fire_lasers", fire_lasers);
                    map.Add("forward_thrust", forward_thrust);
                    map.Add("menu_cancel", menu_cancel);
                    map.Add("menu_down", menu_down);
                    map.Add("menu_left", menu_left);
                    map.Add("menu_right", menu_right);
                    map.Add("menu_select", menu_select);
                    map.Add("menu_up", menu_up);
                    map.Add("pause_menu", pause_menu);
                    map.Add("turn_left", turn_left);
                    map.Add("turn_right", turn_right);
                return map;
                }
            }

        }

    }
}
